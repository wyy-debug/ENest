import{M as e,r as a,c as t}from"./index-DxIqJ1ay.js";import{a as s}from"./index-rSMZb3Ae.js";const o=s.create({baseURL:"http://localhost:8080/api/v1",timeout:1e4,headers:{"Content-Type":"application/json"}});o.interceptors.request.use((e=>{const a=localStorage.getItem("token");return a&&(e.headers.Authorization=`Bearer ${a}`),e}),(e=>Promise.reject(e))),o.interceptors.response.use((e=>e.data),(e=>(e.response&&401===e.response.status&&(localStorage.removeItem("token"),"/login"!==window.location.pathname&&(window.location.href="/login")),Promise.reject(e))));const n=e("user",(()=>{const e=a(localStorage.getItem("token")),s=a(null),n=a(!1),r=t((()=>!!e.value));function l(){e.value=null,s.value=null,localStorage.removeItem("token")}return{token:e,userInfo:s,loading:n,isLoggedIn:r,login:async function(a,t){var r,l;try{n.value=!0;const r=await o.post("/auth/login",{email:a,password:t}),{token:l,user:u}=r;return e.value=l,s.value=u,localStorage.setItem("token",l),{success:!0}}catch(u){return{success:!1,message:(null==(l=null==(r=u.response)?void 0:r.data)?void 0:l.message)||"登录失败，请稍后再试"}}finally{n.value=!1}},register:async function(e,a,t){var s,r;try{return n.value=!0,await o.post("/auth/register",{username:e,email:a,password:t}),{success:!0}}catch(l){return{success:!1,message:(null==(r=null==(s=l.response)?void 0:s.data)?void 0:r.message)||"注册失败，请稍后再试"}}finally{n.value=!1}},getUserInfo:async function(){if(e.value&&!s.value)try{n.value=!0;const e=await o.get("/user");s.value=e}catch(a){l()}finally{n.value=!1}},logout:l,updateProfile:async function(e){var a,t;try{n.value=!0;const a=await o.put("/user",e);return s.value={...s.value,...a},{success:!0}}catch(r){return{success:!1,message:(null==(t=null==(a=r.response)?void 0:a.data)?void 0:t.message)||"更新失败，请稍后再试"}}finally{n.value=!1}}}}));export{o as a,n as u};
