import{d as e,c as a,i as t,r as l,j as s,G as n,E as u,u as r,a as i,b as o,t as d,e as v,w as c,f as m,n as p,p as y,F as f,q as g,g as h,C as b,o as _,h as S,k as w,H as k,I,J as x,K as $,L as C}from"./index-DxIqJ1ay.js";import{u as M}from"./studyRoomStore-DErwerc7.js";import{_ as H}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-rSMZb3Ae.js";const j={class:"room-header"},V={class:"room-info"},D={class:"room-actions"},R={class:"room-content"},T={class:"main-area"},B={class:"study-timer"},K={class:"timer-display"},q={class:"time"},z={class:"timer-status"},A={class:"timer-controls"},E={class:"focus-area"},F={class:"side-panel"},G={class:"members-panel"},J={class:"members-list"},L={class:"member-info"},N={class:"member-name"},U={key:0,class:"member-role"},O={key:1,class:"member-role"},P={class:"member-status"},Q={class:"chat-panel"},W={key:0,class:"message-sender"},X={class:"message-content"},Y={class:"message-time"},Z={key:0,class:"empty-chat"},ee={class:"chat-input"},ae=H(e({__name:"StudyRoomView",setup(e){const H=t(),ae=r(),te=M(),le=a((()=>Number(H.params.id))),se=l(null),ne=l(!1),ue=l(0),re=l(null),ie=l(!1),oe=a((()=>0===ue.value?"准备开始":ie.value?"专注中...":"已暂停")),de=l([{time:"09:30",type:"success",text:"开始学习，专注30分钟"},{time:"10:15",type:"warning",text:"暂停学习"},{time:"10:20",type:"success",text:"继续学习，专注40分钟"}]),ve=l([{senderId:2,content:"大家好，今天有什么学习计划？",time:"09:15"},{senderId:1,content:"我计划学习Vue 3和TypeScript",time:"09:16"},{senderId:3,content:"我正在复习数据结构与算法",time:"09:18"}]),ce=l(""),me=l(null);s((async()=>{await pe(),we()})),n((()=>{re.value&&clearInterval(re.value),ue.value>0&&be()}));const pe=async()=>{ne.value=!0;try{const e=await te.fetchRoomById(le.value);e?se.value=e:(u.error("自习室不存在或已关闭"),ae.push("/"))}catch(e){u.error("获取自习室信息失败")}finally{ne.value=!1}},ye=()=>{C.confirm("确定要离开自习室吗？未保存的学习记录将会丢失。","离开提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await te.leaveRoom(le.value),u.success("已离开自习室"),ae.push("/")}catch(e){u.error("离开自习室失败")}})).catch((()=>{}))},fe=()=>{if(ie.value)return;ie.value=!0,re.value=setInterval((()=>{ue.value++}),1e3);const e=new Date,a=`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`;de.value.push({time:a,type:"success",text:"开始学习"})},ge=()=>{if(!ie.value)return;ie.value=!1,clearInterval(re.value);const e=new Date,a=`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`;de.value.push({time:a,type:"warning",text:`暂停学习，已专注${_e(ue.value)}`})},he=()=>{ie.value=!1,clearInterval(re.value),be(),ue.value=0},be=()=>{const e=new Date,a=`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`;de.value.push({time:a,type:"info",text:`结束学习，本次专注${_e(ue.value)}`})},_e=e=>{const a=Math.floor(e/3600),t=Math.floor(e%3600/60);let l="";return a>0&&(l+=`${a}小时`),(t>0||a>0)&&(l+=`${t}分钟`),0===a&&(l+=`${e%60}秒`),l},Se=()=>{if(!ce.value.trim())return;const e=new Date,a=`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`;ve.value.push({senderId:1,content:ce.value,time:a}),ce.value="",$((()=>{we()}))},we=()=>{me.value&&(me.value.scrollTop=me.value.scrollHeight)},ke=e=>{var a,t;const l=null==(t=null==(a=se.value)?void 0:a.members)?void 0:t.find((a=>a.userId===e));return l?l.username:"未知用户"};return(e,a)=>{var t,l,s,n,u,r,$,C;const M=m("el-button"),H=m("el-icon"),ae=m("el-timeline-item"),te=m("el-empty"),le=m("el-timeline"),ne=m("el-avatar"),re=m("el-input");return _(),i("div",{class:b(["study-room-container",`theme-${(null==(t=se.value)?void 0:t.theme)||"default"}`])},[o("div",j,[o("div",V,[o("h1",null,d(null==(l=se.value)?void 0:l.name),1),o("p",null,d(null==(s=se.value)?void 0:s.description),1)]),o("div",D,[v(M,{onClick:ye,type:"danger",plain:""},{default:c((()=>a[1]||(a[1]=[S("离开自习室")]))),_:1})])]),o("div",R,[o("div",T,[o("div",B,[o("div",K,[o("div",q,d(_e(ue.value)),1),o("div",z,d(oe.value),1)]),o("div",A,[v(M,{type:"primary",onClick:fe,disabled:ie.value,round:""},{default:c((()=>[v(H,null,{default:c((()=>[v(w(k))])),_:1}),a[2]||(a[2]=S(" 开始 "))])),_:1},8,["disabled"]),v(M,{type:"warning",onClick:ge,disabled:!ie.value,round:""},{default:c((()=>[v(H,null,{default:c((()=>[v(w(I))])),_:1}),a[3]||(a[3]=S(" 暂停 "))])),_:1},8,["disabled"]),v(M,{type:"danger",onClick:he,disabled:0===ue.value,round:""},{default:c((()=>[v(H,null,{default:c((()=>[v(w(x))])),_:1}),a[4]||(a[4]=S(" 结束 "))])),_:1},8,["disabled"])])]),o("div",E,[a[5]||(a[5]=o("h2",null,"今日专注记录",-1)),v(le,null,{default:c((()=>[(_(!0),i(f,null,g(de.value,((e,a)=>(_(),p(ae,{key:a,timestamp:e.time,type:e.type},{default:c((()=>[S(d(e.text),1)])),_:2},1032,["timestamp","type"])))),128)),0===de.value.length?(_(),p(te,{key:0,description:"今日暂无学习记录"})):y("",!0)])),_:1})])]),o("div",F,[o("div",G,[o("h2",null,"自习室成员 ("+d((null==(u=null==(n=se.value)?void 0:n.members)?void 0:u.length)||0)+"/"+d((null==(r=se.value)?void 0:r.maxMembers)||0)+")",1),o("div",J,[(_(!0),i(f,null,g(null==($=se.value)?void 0:$.members,(e=>(_(),i("div",{key:e.id,class:b(["member-item",{online:"online"===e.status,away:"away"===e.status}])},[v(ne,{size:"small",src:e.avatar},{default:c((()=>{var a;return[S(d(null==(a=e.username)?void 0:a.charAt(0)),1)]})),_:2},1032,["src"]),o("div",L,[o("div",N,[S(d(e.username)+" ",1),"owner"===e.role?(_(),i("span",U,"(房主)")):"admin"===e.role?(_(),i("span",O,"(管理员)")):y("",!0)]),o("div",P,d("online"===e.status?"在线":"away"===e.status?"离开":"离线"),1)])],2)))),128)),(null==(C=se.value)?void 0:C.members)&&0!==se.value.members.length?y("",!0):(_(),p(te,{key:0,description:"暂无成员"}))])]),o("div",Q,[a[7]||(a[7]=o("h2",null,"聊天",-1)),o("div",{class:"chat-messages",ref_key:"chatContainer",ref:me},[(_(!0),i(f,null,g(ve.value,((e,a)=>(_(),i("div",{key:a,class:b(["message",{"message-self":1===e.senderId}])},[1!==e.senderId?(_(),i("div",W,d(ke(e.senderId)),1)):y("",!0),o("div",X,d(e.content),1),o("div",Y,d(e.time),1)],2)))),128)),0===ve.value.length?(_(),i("div",Z,[v(te,{description:"暂无消息"})])):y("",!0)],512),o("div",ee,[v(re,{modelValue:ce.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ce.value=e),placeholder:"输入消息...",onKeyup:h(Se,["enter"])},{append:c((()=>[v(M,{onClick:Se},{default:c((()=>a[6]||(a[6]=[S("发送")]))),_:1})])),_:1},8,["modelValue"])])])])])],2)}}}),[["__scopeId","data-v-a3ee764f"]]);export{ae as default};
