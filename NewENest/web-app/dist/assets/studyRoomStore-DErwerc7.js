import{M as a,r as s,c as e}from"./index-DxIqJ1ay.js";import{a as t}from"./index-rSMZb3Ae.js";const o=a("studyRoom",(()=>{const a=s([]),o=s(null),u=s(!1),n=e((()=>a.value.filter((a=>1===a.ownerId)))),l=e((()=>a.value.filter((a=>1!==a.ownerId))));async function r(a){try{u.value=!0;const s=await t.get(`/api/study-rooms/${a}`);return o.value=s.data,s.data}catch(s){return null}finally{u.value=!1}}return{rooms:a,currentRoom:o,loading:u,myRooms:n,joinedRooms:l,fetchRooms:async function(){try{u.value=!0;const s=await t.get("/api/study-rooms");a.value=s.data}catch(s){}finally{u.value=!1}},fetchRoomById:r,createRoom:async function(s){var e,o;try{u.value=!0;const e=await t.post("/api/study-rooms",s);return a.value.push(e.data),{success:!0,data:e.data}}catch(n){return{success:!1,message:(null==(o=null==(e=n.response)?void 0:e.data)?void 0:o.message)||"创建自习室失败，请稍后再试"}}finally{u.value=!1}},updateRoom:async function(s,e){var n,l,r;try{u.value=!0;const l=await t.put(`/api/study-rooms/${s}`,e),r=a.value.findIndex((a=>a.id===s));return-1!==r&&(a.value[r]={...a.value[r],...l.data}),(null==(n=o.value)?void 0:n.id)===s&&(o.value={...o.value,...l.data}),{success:!0,data:l.data}}catch(c){return{success:!1,message:(null==(r=null==(l=c.response)?void 0:l.data)?void 0:r.message)||"更新自习室失败，请稍后再试"}}finally{u.value=!1}},joinRoom:async function(a,s=!1){var e,o;try{u.value=!0;await t.post(`/api/study-rooms/${a}/join`,{isAnonymous:s});return await r(a),{success:!0}}catch(n){return{success:!1,message:(null==(o=null==(e=n.response)?void 0:e.data)?void 0:o.message)||"加入自习室失败，请稍后再试"}}finally{u.value=!1}},leaveRoom:async function(a){var s,e,n;try{return u.value=!0,await t.post(`/api/study-rooms/${a}/leave`),(null==(s=o.value)?void 0:s.id)===a&&(o.value=null),{success:!0}}catch(l){return{success:!1,message:(null==(n=null==(e=l.response)?void 0:e.data)?void 0:n.message)||"离开自习室失败，请稍后再试"}}finally{u.value=!1}}}}));export{o as u};
