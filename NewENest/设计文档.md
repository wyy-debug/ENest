# NewENest 设计文档

## 1. 项目概述

NewENest 是对原ENest项目的全面重构，旨在提供一个更加模块化、可扩展且易于维护的在线自习室和学习社区平台。本项目采用前后端分离架构，通过优化代码结构和引入现代化的开发实践，提升系统整体的性能、安全性和用户体验。

## 2. 项目目标

- 重新设计系统架构，实现更好的模块化和可扩展性
- 优化代码结构，提高可维护性
- 增强系统安全性和数据保护能力
- 改善用户体验，提供更友好的界面和交互
- 支持更多学习场景和社交功能
- 优化系统性能和资源利用率

## 3. 系统架构

### 3.1 整体架构

NewENest 采用前后端分离的架构，分为以下主要部分：

1. **前端应用**：基于Vue 3 + TypeScript的单页应用
2. **后端API服务**：基于Go的RESTful API服务
3. **WebSocket服务**：用于实时通信的WebSocket服务
4. **数据库层**：PostgreSQL关系型数据库
5. **缓存层**：Redis用于会话管理和临时数据存储
6. **文件存储**：用于存储用户上传的文件和头像

```
┌─────────────┐       ┌─────────────┐
│   前端应用   │ ←──→ │   API 服务   │
└─────────────┘       └──────┬──────┘
       ↑                     │
       │                     ↓
       │               ┌──────────────┐
       └──────────→ │  WebSocket 服务 │
                     └───────┬────────┘
                             │
                     ┌───────┴────────┐
                     │    数据库层     │
                     └───────┬────────┘
                             │
                     ┌───────┴────────┐
                     │    缓存层      │
                     └───────┬────────┘
                             │
                     ┌───────┴────────┐
                     │   文件存储     │
                     └────────────────┘
```

### 3.2 前端架构

前端采用基于组件的架构，使用Vue 3的Composition API和TypeScript，以提高代码可维护性和类型安全性。

- **核心框架**：Vue 3 + TypeScript
- **状态管理**：Pinia
- **路由管理**：Vue Router
- **UI组件库**：Element Plus
- **HTTP客户端**：Axios
- **WebSocket客户端**：自定义封装
- **构建工具**：Vite

### 3.3 后端架构

后端采用模块化设计，使用Go语言和Fiber框架构建，强调高性能和并发处理能力。

- **核心框架**：Fiber (Go Web框架)
- **数据库ORM**：GORM
- **数据交换**：Protocol Buffers
- **缓存管理**：go-redis
- **认证授权**：JWT + RBAC
- **日志管理**：zerolog
- **依赖注入**：wire

## 4. 数据模型设计

### 4.1 核心实体

1. **用户 (User)**
   - 基本信息：ID、用户名、邮箱、密码哈希等
   - 个人资料：头像、个性签名、学习方向等
   - 统计信息：累计学习时间、成就等

2. **自习室 (StudyRoom)**
   - 基本信息：ID、名称、描述、创建者、分享链接等
   - 配置信息：最大成员数、是否私有、过期时间等
   - 状态信息：当前成员数、创建时间等

3. **好友关系 (Friendship)**
   - 基本信息：用户ID、好友ID、状态（待接受、已接受等）
   - 关系信息：创建时间、更新时间等

4. **学习契约 (StudyContract)**
   - 基本信息：ID、契约类型、契约内容、参与者等
   - 状态信息：状态（活跃、已完成、已终止等）、创建时间等

5. **消息 (Message)**
   - 基本信息：ID、发送者、接收者、内容、类型等
   - 状态信息：是否已读、发送时间等

6. **学习记录 (StudyRecord)**
   - 基本信息：用户ID、自习室ID、开始时间、结束时间等
   - 统计信息：专注时间、中断次数等

### 4.2 数据库模式

详细的数据库表设计见《模型设计文档》

## 5. 功能模块

### 5.1 用户管理模块

- 用户注册与登录
- 个人信息管理
- 用户认证与授权

### 5.2 自习室模块

- 创建、加入自习室
- 自习室管理
- 学习时间统计
- 自习室成员互动

### 5.3 社交模块

- 好友管理
- 学习契约
- 私聊功能

### 5.4 学习记录模块

- 学习时间记录
- 学习数据统计与可视化
- 学习成就系统

### 5.5 通知模块

- 系统通知
- 好友请求通知
- 契约相关通知

## 6. 技术选型

### 6.1 前端技术栈

- **Vue 3**：渐进式JavaScript框架，提供响应式UI构建能力
- **TypeScript**：静态类型检查，提高代码质量和可维护性
- **Pinia**：轻量级状态管理库，Vue 3官方推荐
- **Vue Router**：单页应用路由管理
- **Element Plus**：基于Vue 3的UI组件库
- **Axios**：基于Promise的HTTP客户端
- **Vite**：现代前端构建工具，提供更快的开发体验

### 6.2 后端技术栈

- **Go**：高性能编程语言，适合并发处理
- **Fiber**：Express风格的Go Web框架，高性能且易用
- **GORM**：功能齐全的Go ORM库
- **PostgreSQL**：开源关系型数据库，支持高级特性
- **Redis**：内存数据结构存储，用于缓存和会话管理
- **Protocol Buffers**：高效的二进制数据序列化格式
- **JWT**：用于安全的用户认证
- **WebSocket**：提供实时通信功能

## 7. 安全设计

### 7.1 身份验证

- 使用JWT进行用户身份验证
- 实现多因素认证机制
- 会话管理及安全策略

### 7.2 数据安全

- 敏感数据加密存储
- 传输数据加密（HTTPS/WSS）
- WebSocket消息加密

### 7.3 访问控制

- 基于角色的访问控制（RBAC）
- API请求认证与授权
- 数据访问权限控制

## 8. 性能优化

### 8.1 前端优化

- 代码分割与懒加载
- 静态资源缓存策略
- 渲染性能优化

### 8.2 后端优化

- 数据库查询优化
- 缓存策略
- 并发处理优化

### 8.3 网络传输优化

- 减少请求数量
- 压缩传输数据
- WebSocket连接复用

## 9. 可扩展性设计

- 模块化设计，支持功能扩展
- 插件系统，支持第三方功能集成
- 微服务架构准备，支持未来拆分

## 10. 部署架构

### 10.1 开发环境

- 本地开发环境
- Docker容器化开发环境

### 10.2 生产环境

- Kubernetes集群部署
- 负载均衡与高可用设计
- 监控与日志收集

## 11. 迭代计划

### 第一阶段：基础架构

- 搭建前端框架
- 实现后端核心服务
- 设计并实现数据库模型
- 实现基本用户认证功能

### 第二阶段：核心功能

- 实现自习室功能
- 实现好友与社交功能
- 完善用户个人中心
- 实现实时通信

### 第三阶段：功能拓展

- 实现学习统计与可视化
- 实现学习契约功能
- 优化用户体验
- 完善通知系统

### 第四阶段：性能与安全

- 全面安全审计
- 性能优化
- 压力测试与修复
- 文档完善

## 12. 风险评估与应对策略

- 技术风险
- 项目进度风险
- 用户体验风险
- 安全风险

## 13. 参考资料

- 原ENest项目文档
- 相关技术文档与最佳实践指南 